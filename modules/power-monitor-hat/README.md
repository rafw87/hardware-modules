# Power monitor HAT

Turns your Raspberry PI into 3-channel power monitor.

## Features
 - 3 separate channels, each with own INA219 chip and shunt resistor (see below for resistor selection)
 - Different possible power sources (controlled by jumpers):
   - external (separate input for each channel)
   - internal 5V or 3.3V, powered from common DC input (5V) or optionally from Raspberry's 5V.
 - DC input for internal 5V source, it may be shorted with Raspberry's 5V or kept as separate circuit.
   There is a fuse and an "ideal diode" circuit protecting DC source when shorted.
 - LDO regulator for internal 3.3V source.
 - 4 LEDs:
   - PWR (connected to 5V bus)
   - 3 LEDs, one for each channel, connected to channel's VIN
 - Header for UART - to communicate with measured device
 - Test points for I2C
 
## Devices list

### I2C
 Address | Device   | Description 
:-------:|:--------:|:-----------:
|  0x40  |  INA219  | Channel 1  
|  0x41  |  INA219  | Channel 2  
|  0x42  |  INA219  | Channel 3  


## Shunt resistor selection

Equations and tables below may help to select proper shunt resistor according to needs.

### Current

$R_{shunt}$ | Absolute maximum current* | Maximum measurable current** | Maximum recommended current**
:----------:|:-------------------------:|:----------------------------:|:-----------------------------:
|  0.1Ω     | 2.73A / 3.16A             | 3.20A                        | 0.40A
|  0.2Ω     | 1.93A / 2.23A               | 1.60A                        | 0.20A
|  0.5Ω     | 1.22A / 1.41A               | 0.64A                        | 0.08A
|  1.0Ω     | 0.86A / 1.00A               | 0.32A                        | 0.04A

\* Maximum allowed current for (respecively) 0.75W and 1W rated resistor of given resistance. Remember to include some margin for safety purpose. Equation:
  $$I = \sqrt{P_{max} \over R_{shunt}}$$

\** Maximum measurable ( $PGA = /8$, $V_{pga} = \pm 320mV$ ) and recommended ( $PGA = 1$, $V_{pga} = \pm 40mV$ ) current for given resistor. Equation:
  $$I = {V_{pga} \over R_{shunt}}$$


### Voltage drop

$R_{shunt}$ / $I$ | 0.1A  | 0.2A  | 0.5A  | 1A     | 2A
:----------------:|:-----:|:-----:|:-----:|:------:|:----:
|  0.1Ω           | 0.01V | 0.02V | 0.05V | 0.10V  | 0.20V
|  0.2Ω           | 0.02V | 0.04V | 0.10V | 0.20V  | 0.40V
|  0.5Ω           | 0.05V | 0.10V | 0.25V | 0.50V  | 1.00V
|  1.0Ω           | 0.10V | 0.20V | 0.50V | 1.00V  | 2.00V

Equation:
$$V_{shunt} = R_{shunt} * I$$


### Tolerance and temperature coefficient
Simple answer: less is better (but more expensive) :)

Depends on actual purpose of HAT and expected quality of measurements.

Current measurement tolerance is linear to resistor tolerance, so for 1% tolerance we can expect also 1% variation of current measurement.

Due of temperature coefficient, it's also recommended to not "stress" resistor close to its maximum power rating, causing excessive heating.
Some heat is unfortunately generated by RaspberryPI itself. If needed, it may be compensated programmatically (knowing temperature coefficient and actual temperature) or HAT may be connected using extension cable to not be affected by RPi's heat.
